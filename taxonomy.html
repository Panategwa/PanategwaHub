<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Panategwa Hub - Taxonomy</title>
  <link href="https://fonts.googleapis.com/css2?family=Rubik:wght@400;700&display=swap" rel="stylesheet" />
  <link rel="stylesheet" href="styles.css" />
  <script src="menu-loader.js" defer></script>
</head>
<body>

  <!-- menu will inject here -->
  <div id="menu-container"></div><br>

  <h1>Panategwa d Taxonomy Explorer</h1>

  <div id="current-rank">Domains</div>
  <div id="breadcrumbs"></div>

  <div id="control-buttons">
    <button id="back-button">⬅ Back</button>
    <button id="close-button">✖ Close All</button>
  </div>

  <input type="text" id="search-bar" placeholder="Search any rank...">
  <div id="search-results"></div>

  <div id="taxonomy-container"></div>

<script>
// --- TAXONOMY DATA ---
const taxonomy = {
  domains: [
    {
      name: "Eukarya",
      kingdoms: [
        {
          name: "Animalia",
          phyla: [
            {
              name: "Chordata",
              classes: [
                {
                  name: "Mammalia",
                  orders: [
                    {
                      name: "Primates",
                      families: [
                        {
                          name: "Hominidae",
                          genera: [
                            { name: "Homo", species: ["Homo sapiens"] },
                            { name: "Triopanathropus", species: ["Triopanathropus panategwanus"] }
                          ]
                        }
                      ]
                    }
                  ]
                }
              ]
            }
          ]
        },
        { name: "Plantae", phyla: [] }
      ]
    },
    { name: "Prokarya", kingdoms: [] },
    { name: "Mycota-Pan", kingdoms: [] }
  ]
};

// --- STATE ---
let currentPath = [];
let nodePathStack = [taxonomy.domains];
let currentRank = ["Domains"];

// --- UTILITY FUNCTIONS ---
function getChildren(node){
  if(node.kingdoms) return node.kingdoms;
  if(node.phyla) return node.phyla;
  if(node.classes) return node.classes;
  if(node.orders) return node.orders;
  if(node.families) return node.families;
  if(node.genera) return node.genera;
  if(node.species) return node.species.map(s => ({name:s}));
  return [];
}

function getRankName(level){
  const ranks = ["Domains","Kingdoms","Phyla","Classes","Orders","Families","Genera","Species"];
  return ranks[level] || "";
}

function renderLevel(items){
  const container = document.getElementById("taxonomy-container");
  container.innerHTML = "";
  items.forEach(item => {
    const btn = document.createElement("button");
    btn.textContent = item.name;
    btn.onclick = () => {
      currentPath.push(item.name);
      nodePathStack.push(getChildren(item));
      currentRank.push(getRankName(currentRank.length));
      renderLevel(getChildren(item));
      updateUI();
    };
    container.appendChild(btn);
  });
  updateUI();
}

function updateUI(){
  document.getElementById("breadcrumbs").textContent = currentPath.join(" > ");
  document.getElementById("current-rank").textContent = currentRank[currentRank.length-1];
}

// --- SEARCH FUNCTIONS ---
function findRanks(query, node, path = []){
  let matches = [];
  if(node.name && node.name.toLowerCase().includes(query)) matches.push({path:[...path, node.name], node: node});
  if(node.species){
    node.species.forEach(s => {
      if(s.toLowerCase().includes(query)) matches.push({path:[...path, s], node: {species:[s]}});
    });
  }
  for(let key in node){
    if(Array.isArray(node[key])){
      node[key].forEach(child => matches = matches.concat(findRanks(query, child, [...path, node.name || ""])));
    }
  }
  return matches;
}

function showSearchResults(results){
  const container = document.getElementById("search-results");
  container.innerHTML = "";
  results.forEach(item => {
    const div = document.createElement("div");
    div.textContent = item.path.filter(n=>n!=="").join(" > ");
    div.onclick = () => {
      // Navigate to clicked node
      currentPath = item.path.filter(n=>n!=="");
      nodePathStack = [taxonomy.domains];
      currentRank = ["Domains"];
      let node = {domains: taxonomy.domains};
      for(let i=0;i<currentPath.length;i++){
        let name = currentPath[i];
        let children = getChildren(node);
        let found = children.find(c=>c.name===name || c===name);
        nodePathStack.push(children);
        currentRank.push(getRankName(i+1));
        node = found;
      }
      renderLevel(getChildren(node));
      updateUI();
      container.innerHTML = "";
      document.getElementById("search-bar").value = "";
    };
    container.appendChild(div);
  });
}

// --- EVENT LISTENERS ---
document.getElementById("search-bar").addEventListener("input", e=>{
  const query = e.target.value.toLowerCase();
  const results = findRanks(query, taxonomy);
  showSearchResults(results);
});

document.getElementById("back-button").addEventListener("click", ()=>{
  if(currentPath.length === 0) return;
  currentPath.pop();
  nodePathStack.pop();
  currentRank.pop();
  renderLevel(nodePathStack[nodePathStack.length-1]);
  updateUI();
});

document.getElementById("close-button").addEventListener("click", ()=>{
  currentPath = [];
  nodePathStack = [taxonomy.domains];
  currentRank = ["Domains"];
  renderLevel(nodePathStack[0]);
  document.getElementById("breadcrumbs").textContent = "";
  document.getElementById("search-results").innerHTML = "";
  document.getElementById("search-bar").value = "";
  updateUI();
});

// --- INITIAL RENDER ---
renderLevel(taxonomy.domains);
updateUI();

</script>
</body>
</html>
